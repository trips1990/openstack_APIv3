#!/bin/bash
LOG_FILE=/home/sancopy/session-reports.log
N=1
now=`date +"%H%M-%d%m%Y"`
now1=`date +"%H:%M %d%-m-%Y"`
file=/home/sancopy/session-reports/PAR4-Report-${now}.csv
output() {
        session=`awk '{print $4}' text | sed 2,3d`,
        status=`awk '{print $3" "$4" "$5}' text | sed 1d | sed 2d`,
        time=`awk '{print $3" "$4}' text | sed 1,2d`,
        echo "$N," $session $status $time >> $file
        N=$((N+1))
}
echo "no., Session, Status, Time," > $file
echo "Script started at ${now}" >> $LOG_FILE 2>&1
while IFS= read -r line; do
    echo "getting session reports for $line" >> $LOG_FILE 2>&1
    echo $line > text2
    session=`awk '{print $1}' text2`
    ip=`awk '{print $2}' text2`
    pass=`awk '{print $3}' text2`
    /opt/Navisphere/bin/naviseccli -user nttcadmin -password $pass -scope 0 -address $ip sancopy -info -name $session -sessionstatus -time > text
    output >> $LOG_FILE 2>&1
done < text1
#echo "This report has been autogenerated by Paris backup control server." | mailx -v -s "Correct Report-MY" -a $file -S smtp=smtp://x.y.w.v:25 -S from="test@test.com" paresh.tripathi@ncloud.com >> $LOG_FILE 2>&1
echo "Script execution completed successfully, please refer reports for backup status" >> $LOG_FILE 2>&1
